<!-- weather.html (can run in DevCanvas/Wix/anywhere) -->
<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Oyunsanaa ¬∑ Weather</title>
<style>
  :root{
    --brand:#AC532A;
    --glass-bg: rgba(255,255,255,.06);
    --glass-brd: rgba(255,255,255,.12);
    --text:#EDEDED;
    --muted:#A9A9A9;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:ui-sans-serif,system-ui,Arial;
    color:var(--text); background:linear-gradient(180deg,#0E0E10 0%, #131316 100%);
    display:flex; align-items:flex-start; justify-content:center; padding:32px;
  }
  .wrap{width:min(1024px,100%);}

  header{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px}
  .title{font-weight:800; font-size:28px; letter-spacing:.3px; color:var(--brand); text-shadow:0 0 28px rgba(172,83,42,.35)}
  .search{display:flex; gap:10px; width:100%; max-width:520px}
  .input{
    flex:1; height:44px; padding:0 14px; border-radius:12px; border:1px solid var(--glass-brd);
    background:var(--glass-bg); color:var(--text); outline:none; backdrop-filter: blur(12px);
  }
  .btn{
    height:44px; padding:0 16px; border:none; border-radius:12px; background:var(--brand); color:#fff; cursor:pointer;
    box-shadow:0 0 28px rgba(172,83,42,.32);
  }
  .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:16px}
  .card{
    background:var(--glass-bg); border:1px solid var(--glass-brd); backdrop-filter: blur(12px);
    border-radius:16px; padding:18px; box-shadow:0 0 34px rgba(172,83,42,.22); min-height:220px; position:relative; overflow:hidden;
  }
  .subgrid{display:grid; grid-template-rows:auto auto 1fr; gap:16px}
  .today h2{margin:0 0 6px 0; font-size:14px; color:var(--muted); font-weight:700}
  .temp{font-size:56px; font-weight:800; line-height:1; margin:6px 0 10px}
  .meta{display:flex; gap:18px; color:var(--muted); font-size:14px}
  .forecast{display:flex; gap:12px; overflow-x:auto; padding-bottom:4px}
  .chip{
    min-width:120px; text-align:center; padding:10px; border-radius:12px; background:rgba(255,255,255,.06);
    border:1px solid var(--glass-brd);
  }
  .chip .d{font-size:12px; color:var(--muted); margin-bottom:6px}
  .chip .t{font-weight:700}
  .skeleton{
    --sh: 220px;
    min-height: var(--sh);
    background:
      linear-gradient(90deg, rgba(255,255,255,.06) 25%, rgba(255,255,255,.12) 37%, rgba(255,255,255,.06) 63%) 0/200% 100%;
    animation: loading 1.2s infinite;
    border-radius:16px; border:1px solid var(--glass-brd);
  }
  @keyframes loading { to { background-position: -200% 0; } }
  .err{position:absolute; inset:auto 16px 16px 16px; padding:10px 12px; border-radius:10px;
    border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.05); color:#ffd6c3}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Oyunsanaa ¬∑ Weather</div>
      <form class="search" id="frm">
        <input class="input" id="coords" placeholder="lat,lon  (–∂: 47.92,106.92)" />
        <button class="btn" id="go" type="submit">–•–∞–π—Ö</button>
      </form>
    </header>

    <div class="grid">
      <section class="card today" id="card-today">
        <div class="skeleton" style="--sh:220px"></div>
      </section>

      <section class="card" id="card-forecast">
        <div class="skeleton" style="--sh:220px"></div>
      </section>
    </div>
  </div>

<script>
  const API_BASE = 'https://tsag-agaar-kappa.vercel.app; // ‚Üê ”©”©—Ä–∏–π–Ω Vercel –¥–æ–º—ç–π–Ω

  const elToday = document.getElementById('card-today');
  const elForecast = document.getElementById('card-forecast');
  const frm = document.getElementById('frm');
  const coords = document.getElementById('coords');

  const DEFAULT = { lat: 47.92, lon: 106.92 };

  function dateLabel(iso){ const d = new Date(iso); return d.toLocaleDateString('mn-MN',{ weekday:'short', month:'short', day:'numeric'}); }

  function weatherIcon(wc){
    // simple mapping (clear=0, mainly clear=1-3, rain=51..67|80..82, snow=71..77|85..86)
    if ([0].includes(wc)) return '‚òÄÔ∏è';
    if ([1,2,3,45,48].includes(wc)) return '‚õÖÔ∏è';
    if ((wc>=51&&wc<=67)||(wc>=80&&wc<=82)) return 'üåßÔ∏è';
    if ((wc>=71&&wc<=77)||(wc==85)||(wc==86)) return '‚ùÑÔ∏è';
    if (wc>=95) return '‚õàÔ∏è';
    return 'üå§Ô∏è';
  }

  async function fetchWeather(lat, lon){
    const url = `${API_BASE}/api/weather?lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`;
    const r = await fetch(url);
    if (!r.ok) throw new Error(`API ${r.status}`);
    return r.json();
  }

  function renderToday(data){
    const c = data.current_weather;
    const rh = data.hourly?.relative_humidity_2m?.[0];
    const p = data.hourly?.pressure_msl?.[0];
    elToday.innerHTML = `
      <h2>”®–Ω”©”©–¥”©—Ä ¬∑ ${new Date(c.time).toLocaleTimeString('mn-MN',{hour:'2-digit',minute:'2-digit'})}</h2>
      <div class="temp">${Math.round(c.temperature)}¬∞C ${weatherIcon(c.weathercode)}</div>
      <div class="meta">
        <div>–°–∞–ª—Ö–∏: ${c.windspeed} –∫–º/—Ü</div>
        <div>–ß–∏–π–≥—à–∏–ª: ${rh ?? '‚Äî'}%</div>
        <div>–î–∞—Ä–∞–ª—Ç: ${p ?? '‚Äî'} hPa</div>
      </div>
    `;
  }

  function renderForecast(data){
    const d = data.daily;
    const chips = d.time.map((t,i)=>`
      <div class="chip">
        <div class="d">${dateLabel(t)}</div>
        <div class="t">${Math.round(d.temperature_2m_min[i])}¬∞ / ${Math.round(d.temperature_2m_max[i])}¬∞</div>
        <div style="margin-top:6px">${weatherIcon(d.weathercode[i])}</div>
        <div style="font-size:12px;color:var(--muted);margin-top:4px">Rain: ${d.precipitation_sum[i]}mm</div>
      </div>`).join('');
    elForecast.innerHTML = `
      <h2 style="margin:0 0 10px 0; font-size:14px; color:var(--muted); font-weight:700">7 —Ö–æ–Ω–æ–≥</h2>
      <div class="forecast">${chips}</div>
    `;
  }

  function showError(container, msg){
    container.innerHTML = container.innerHTML + `<div class="err">–ê–ª–¥–∞–∞: ${msg}</div>`;
  }

  async function load(lat = DEFAULT.lat, lon = DEFAULT.lon){
    elToday.innerHTML = `<div class="skeleton" style="--sh:220px"></div>`;
    elForecast.innerHTML = `<div class="skeleton" style="--sh:220px"></div>`;
    try{
      const data = await fetchWeather(lat, lon);
      renderToday(data);
      renderForecast(data);
    }catch(e){
      showError(elToday, e.message || e);
      showError(elForecast, e.message || e);
    }
  }

  frm.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    let lat = DEFAULT.lat, lon = DEFAULT.lon;
    const v = (coords.value || '').trim();
    if (v.includes(',')) {
      [lat, lon] = v.split(',').map(x=>Number(x.trim()));
    }
    load(lat, lon);
  });

  load();
</script>
</body>
</html>
