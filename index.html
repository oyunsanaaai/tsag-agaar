<!-- index.html -->
<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Oyunsanaa ¬∑ Weather</title>
  <style>
    :root{
      --brand:#AC532A;
      --text:#222;
      --muted:#5e5e5e;
      --glass-bg:rgba(255,255,255,.5);
      --glass-brd:rgba(255,255,255,.7);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Arial;
      color:var(--text);
      background:linear-gradient(180deg,#f9f9fb 0%, #eaecef 100%);
      display:flex; justify-content:center; align-items:flex-start; padding:24px;
    }
    .wrap{width:min(1024px,100%)}
    header{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px}
    .title{font-weight:800; font-size:24px; color:var(--brand); letter-spacing:.2px; text-shadow:0 0 28px rgba(172,83,42,.25)}
    .search{display:flex; gap:10px; width:100%; max-width:560px}
    .input{
      flex:1; height:44px; padding:0 14px; border-radius:12px; border:1px solid var(--glass-brd);
      background:var(--glass-bg); backdrop-filter:blur(14px); color:var(--text); outline:none;
    }
    .btn{
      height:44px; padding:0 16px; border:none; border-radius:12px; background:var(--brand); color:#fff; cursor:pointer;
      box-shadow:0 0 30px rgba(172,83,42,.28);
    }
    .grid{display:grid; grid-template-columns:1.1fr .9fr; gap:16px}
    .card{
      position:relative;
      background:var(--glass-bg); border:1px solid var(--glass-brd); backdrop-filter:blur(14px);
      border-radius:16px; padding:18px; min-height:220px; box-shadow:0 0 34px rgba(172,83,42,.18);
    }
    .muted{color:var(--muted)}
    .temp{font-size:56px; font-weight:800; line-height:1; margin:6px 0 10px}
    .meta{display:flex; gap:18px; color:var(--muted); font-size:14px; flex-wrap:wrap}
    .forecast{display:flex; gap:12px; overflow-x:auto; padding-bottom:4px}
    .chip{
      min-width:120px; text-align:center; padding:10px; border-radius:12px;
      background:rgba(255,255,255,.6); border:1px solid var(--glass-brd);
    }
    .chip .d{font-size:12px; color:var(--muted); margin-bottom:6px}
    .chip .t{font-weight:700}
    .skeleton{
      --sh:220px;
      min-height:var(--sh);
      background:linear-gradient(90deg, rgba(0,0,0,.05) 25%, rgba(0,0,0,.08) 37%, rgba(0,0,0,.05) 63%) 0/200% 100%;
      animation:loading 1.2s infinite;
      border-radius:16px; border:1px solid var(--glass-brd);
    }
    @keyframes loading{to{background-position:-200% 0}}
    .err{
      position:absolute; inset:auto 16px 16px 16px;
      padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.08);
      background:rgba(255,235,228,.8); color:#6b2d16; font-size:14px;
    }
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Oyunsanaa ¬∑ Weather</div>
      <form class="search" id="frm">
        <input class="input" id="coords" placeholder="lat,lon  (–∂: 47.92,106.92)" />
        <button class="btn" type="submit">–•–∞–π—Ö</button>
      </form>
    </header>

    <div class="grid">
      <section class="card" id="card-today"><div class="skeleton" style="--sh:220px"></div></section>
      <section class="card" id="card-forecast"><div class="skeleton" style="--sh:220px"></div></section>
    </div>
  </div>

<script>
  const API_BASE = "https://tsag-agaar-kappa.vercel.app";

  const elToday = document.getElementById("card-today");
  const elForecast = document.getElementById("card-forecast");
  const frm = document.getElementById("frm");
  const coords = document.getElementById("coords");
  const DEFAULT = { lat: 47.92, lon: 106.92 };

  function dateLabel(iso){
    const d = new Date(iso);
    return d.toLocaleDateString("mn-MN",{weekday:"short", month:"short", day:"numeric"});
  }
  function iconFor(code){
    if ([0].includes(code)) return "‚òÄÔ∏è";
    if ([1,2,3,45,48].includes(code)) return "‚õÖÔ∏è";
    if ((code>=51&&code<=67)||(code>=80&&code<=82)) return "üåßÔ∏è";
    if ((code>=71&&code<=77)||code===85||code===86) return "‚ùÑÔ∏è";
    if (code>=95) return "‚õàÔ∏è";
    return "üå§Ô∏è";
  }
  async function fetchWeather(lat,lon){
    const r = await fetch(`${API_BASE}/api/weather?lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`);
    if(!r.ok) throw new Error(`API ${r.status}`);
    const j = await r.json();
    if (!j.ok) throw new Error(j.error || "API error");
    return j.data;
  }
  function renderToday(data){
    const c = data.current_weather;
    const rh = data.hourly && data.hourly.relative_humidity_2m ? data.hourly.relative_humidity_2m[0] : "‚Äî";
    const p  = data.hourly && data.hourly.pressure_msl ? data.hourly.pressure_msl[0] : "‚Äî";
    elToday.innerHTML =
      `<div class="muted" style="font-weight:700;margin-bottom:6px">”®–Ω”©”©–¥”©—Ä ¬∑ ${
        new Date(c.time).toLocaleTimeString("mn-MN",{hour:"2-digit",minute:"2-digit"})
      }</div>
       <div class="temp">${Math.round(c.temperature)}¬∞C ${iconFor(c.weathercode)}</div>
       <div class="meta">
         <div>–°–∞–ª—Ö–∏: ${c.windspeed} –∫–º/—Ü</div>
         <div>–ß–∏–π–≥—à–∏–ª: ${rh}%</div>
         <div>–î–∞—Ä–∞–ª—Ç: ${p} hPa</div>
       </div>`;
  }
  function renderForecast(data){
    const d = data.daily;
    const chips = d.time.map((t,i)=>
      `<div class="chip">
         <div class="d">${dateLabel(t)}</div>
         <div class="t">${Math.round(d.temperature_2m_min[i])}¬∞ / ${Math.round(d.temperature_2m_max[i])}¬∞</div>
         <div style="margin-top:6px">${iconFor(d.weathercode[i])}</div>
         <div style="font-size:12px;color:var(--muted);margin-top:4px">Rain: ${d.precipitation_sum[i]}mm</div>
       </div>`
    ).join("");
    elForecast.innerHTML = `<div class="muted" style="font-weight:700;margin-bottom:10px">7 —Ö–æ–Ω–æ–≥</div><div class="forecast">${chips}</div>`;
  }
  function showError(container,msg){
    container.innerHTML = container.innerHTML + `<div class="err">–ê–ª–¥–∞–∞: ${msg}</div>`;
  }
  async function load(lat=DEFAULT.lat, lon=DEFAULT.lon){
    elToday.innerHTML = `<div class="skeleton" style="--sh:220px"></div>`;
    elForecast.innerHTML = `<div class="skeleton" style="--sh:220px"></div>`;
    try{
      const data = await fetchWeather(lat,lon);
      renderToday(data);
      renderForecast(data);
    }catch(e){
      showError(elToday, e.message || e);
      showError(elForecast, e.message || e);
    }
  }
  frm.addEventListener("submit",(ev)=>{
    ev.preventDefault();
    let lat = DEFAULT.lat, lon = DEFAULT.lon;
    const v = (coords.value || "").trim();
    if (v.includes(",")) { const a = v.split(","); lat = Number(a[0].trim()); lon = Number(a[1].trim()); }
    load(lat,lon);
  });
  load();
</script>
</body>
</html>
